---
title: "Devise: find by username OR email"
date: 2011-09-28
created_at: 2011-09-28T21:30:32Z
updated_at: 2015-09-27T09:37:57Z
---

<strong>devise.find_by_username_or_email.rb</strong>

    class User
      extend ClassMethods
    
      devise :database_authenticatable, :omniauthable, :registerable, :confirmable, :recoverable, :rememberable
    
      module ClassMethods
        def find_for_database_authentication(conditions)
          value = conditions[authentication_keys.first]
          where(["username = :value OR email = :value", { :value => value }]).first
        end
    
        def send_reset_password_instructions(attributes={})
          super(authentication_attribute(attributes))
        end
    
        def send_confirmation_instructions(attributes={})
          super(authentication_attribute(attributes))
        end
    
        protected
          # determine email by username
          def authentication_attribute(attributes)
            user = self.find_by_username(attributes[:email])
            attributes[:email] = user[:email] if user
            attributes
          end
      end
    end

[fork or comment at github](https://gist.github.com/1249314)
